@using DAL;
@if (Model != null)
{
    foreach(var item in Model)
    {
        <tr>
            @if (item.DateCreate.Date >= DateTime.Now.Date)
            {
                <td width="15%"><span>@item.DateCreate.ToString("dd/MM/yyyy hh:mm:ss")</span></td>
            }
            else
            {
                <td width="15%"><strong style="color:red">@item.DateCreate.ToString("dd/MM/yyyy hh:mm:ss")</strong></td>
            }
            <td><strong style="color:#435a39" class="kethucphieu">@item.MaPhieu</strong></td>
            @if (item.Status == 0)
            {
                <td>
                   @{ 
                       DAL_TheTai dalThetai = new DAL_TheTai(); 
                   }

                    <button class="btn btn-sm btn-primary"  style="margin-right:5px;cursor:pointer;color:#ffffff"  onclick="updateStatus('@item.TheTaiChiTietID','@item.MaPhieu','@dalThetai.GetUserthetaichitiet(item.TheTaiChiTietID)')" /> <span class="text-white text-primary trangthaigiao">Kết thúc</span>
                    <button class="btn btn-sm btn-danger" style="margin-top:5px;margin-right:5px;cursor:pointer;color:#ffffff" onclick="cancle('@item.TheTaiChiTietID')" /> <span class="text-white text-danger trangthaigiao">Hủy</span>
                 </td>
            }
            @if (item.Status == 1)
            {
                <td><button class="btn btn-sm btn-primary"  style="margin-right:5px;cursor:pointer;color:#ffffff" disabled  checked/> <span  class="text-danger text-white trangthaigiao">Đã giao</span> </td>
            }
            @if (item.Status == -1)
            {
                <td><button class="btn btn-sm btn-danger" style="margin-right:5px;cursor:pointer;color:#ffffff" disabled checked /> <span class="text-danger text-white trangthaigiao">Đã hủy</span> </td>
            }
            <td>
                @item.DateEnd
            </td>
            <td style="width:20%">
                @if (item.TienPhatSinh!=null && item.TienPhatSinh!=0)
                {
                    <div><span>Tiền phát sinh: </span> @item.TienPhatSinh.ToString("#,##0")</div>
                }
                @if (item.SoKMPhatSinh!=null && item.SoKMPhatSinh!=0)
                {
                    <div><span>Số KM phát sinh: </span> @item.SoKMPhatSinh.ToString("#,##0")</div>
                }
                @if (item.Description != "")
                {
                    <span>Ghi chú: </span> <strong class="text-danger">@item.Description</strong>
                }
               
            </td>
        </tr>
    }
}

<script>
    function updateStatus(id, maphieu, username) {
        $("#TienPhatSinh").show();
        $("#SoKMPhatSinh").show();
        $("#expleHuyphieu").html("Kết thúc phiếu");
        $("#exampleModal").modal("toggle");
        type = 1;
        slId = id;
        //return;
        //var param = {
        //    "TheTaiChiTietID": id
        //}
        //$.ajax({
        //    url: '/TheTai/updateStatus',
        //    type: 'POST',
        //    dataType: 'html',
        //    data: param,
        //    success: function (data, status, xhr) {
		//	saveId(username,maphieu);
        //        window.location.reload();
        //    },
        //    error: function (xhr, status, error) {
        //        alert(status);
        //    }
        //});
    }
  function saveId(user,id)
		{
			var ua = navigator.userAgent.toLowerCase();

			var isAndroid = ua.indexOf("android") > -1; //&& ua.indexOf("mobile");
			if(isAndroid) {
			Android.nextScreen(user,id);
			}
		}
  function cancle(id) {
      $("#TienPhatSinh").hide();
      $("#SoKMPhatSinh").hide();
      $("#expleHuyphieu").html("Hủy phiếu");
      slId = id;
      type = 2;
      $("#exampleModal").modal("toggle");
  }
</script>